\documentclass[11pt]{article}

\usepackage{amsmath, amssymb}
\usepackage{listings}
\usepackage{gensymb}
\usepackage[english]{babel}

\begin{document}
\section*{Task 1.1}
The kinimatics of parameteres from body in NED is given by 
\[ \dot{p} = U(Q) v \]
\[\dot{Q} = T(Q, \omega) \]
Where Q, U, and T are paremetrized from:
\subsection*{1. euler angles}
\[Q = 
\begin{bmatrix}
\phi \\ \theta \\ \psi
\end{bmatrix}
\]

\[ U(Q) = 
\begin{bmatrix}
\cos{\psi} \cos{\theta} && - \sin{\psi} \cos{\phi} + \cos{\psi} \sin{\theta} \sin{\phi} && \sin{\psi} \sin{\phi} + \cos{\psi} \cos{\phi} \sin{\theta} \\
\sin{\psi} \cos{\phi} && \cos{\psi} \cos{\phi} + \sin{\phi} \sin{\theta} \sin{\psi} && - \cos{\theta} \cos{\phi}
\end{bmatrix}
\]

\[ T(Q, \omega)
\begin{bmatrix}
\displaystyle
1 && \sin{\phi} \tan{\theta} && \cos{\phi} \tan{\theta} \\
0 && \cos{\phi} && - \sin{\phi} \\
0 && - \frac{ \sin{\phi} }{ \cos{\theta} } && \frac{ \cos{\phi} }{ \cos{\theta} }
\end{bmatrix} \omega
\]

\subsection*{2. unit quaternions}
\[Q = \{q|q^Tq = 1, q = [\eta,\epsilon^T]^T\};\epsilon \in \mathbb{R}^3, \eta \in \mathbb{R} \]

\[U(Q) = R_b^n(q) = R_{\eta,\epsilon} = I_{3x3} + 2\eta S(\epsilon) 2S^2(\epsilon) \]
\[ T(Q,\omega) = T_q(q)\omega = 
\frac{1}{2}
 \begin{bmatrix}
   -\epsilon_1 & -\epsilon_2 & \epsilon_3 \\
   \eta & -\epsilon_3 & \epsilon_2 \\
   \epsilon_3 & \eta & -\epsilon_1 \\
   -\epsilon_2 & \epsilon_1 & \eta \\
 \end{bmatrix}
 \omega
\]


\subsection*{3. rotation matrix}
\begin{equation}
 Q = R_b^n
\end{equation}
\begin{equation}
 U(Q) = Q = R_b^n
\end{equation}
\begin{equation}
 T(Q,\omega) = R_b^nS(\omega)
\end{equation}

\section*{Task 1.2}
Euler's second axiom states
\[ \frac{^i d}{dt} h_g = m_g, h_g = I_g \omega_{b/i} \]
Under the assumption that NED is intertial while BODY is not inertial.
\begin{eqnarray*}
m_g &=& \frac{^i d}{dt}(I_g \omega_{b/i}) \\
&=& \frac{^i d}{dt}(I_g \omega_{b/n}) \\
&=& \frac{^b d}{dt}(I_g \omega_{b/n}) + \omega_{b/n} \times (I_g \omega_{b/n}) \\
&=& I_g \omega_{b/n} - (I_g \omega{b/n}) \times \omega{b/n}
\end{eqnarray*}
Where $I_g = I_{CG}$ is the intertia matrix in CG, $\omega_{b/n} = \omega$ is the rotational velocity of the satelite refered to NED, and $m_g = \tau$ is the torque which in the ideal noiseless case is the control input. As stated earlyer, NED is assumed to be inertial in order for this model to be valid.

\section{Task 1.3}
Euler angle's are highly intuitive but has the drawback of a singularity. Quaternions doesn't got this singularity but are not so intuitive and introduce some numerical challenges in keeping them normalized. Rotation matrices require less computation to apply since both quaternions and euler angles needs to be converted to a rotation matrix, but 
\\[+1cm] TODO write about rotation matrices

\section{Task 2.1}
Given the system
\[I_g \dot \omega - (I_g \omega) \times \omega = \tau \]
I wish to design a controller outputing $\tau$ which will make the system lyupnov stable. Choosing the lyupnov candidate function as:
\[V = \frac{1}{2} \omega^T I_g \omega + \frac{1}{2} \dot \tilde \theta^T K_p \tilde \theta \]
This function  positive definite since $I_g$ are positive definite and $K_p$ are chosen to be positive definite.
\begin{eqnarray*}
\dot V &=& \frac{1}{2} [ \dot \omega^T I_g \omega + \omega^T I_g \dot \omega + \dot \tilde \theta^T K_p \tilde \theta + \tilde \theta^T K_p \dot \tilde \theta ] \\
&=& \frac{1}{2} [ \dot \omega^T I_g \omega + \omega^T I_g \dot \omega + \omega^T T^T K_p \tilde \theta + \tilde \theta^T K_p T \omega ] \\
&=& \frac{1}{2} [\omega^T ( I_g \dot \omega + T^T K_p \tilde \theta) + (\dot \omega^T I_g + \tilde \theta^T K_p T) \omega ] \\
&=& \frac{1}{2} [\omega^T (I_g \dot \omega + T^T K_p \tilde \omega) + (I_g \dot \omega + T^T K_p \tilde \omega)^T \omega ] 
\end{eqnarray*}
Since $I_g$ is a diagonal matrix. And $K_d$ will be chosen to be a diagonal matrix. If $I_g \dot \omega + T^T K_p \tilde \omega = - K_d \omega$, where $K_d$ is a positive definit diagonal matrix then 
\[\dot V = - \omega^T K_d \omega \]
and thus negative definite and the system will be stable. Meaning for the system to be stable, it is sufficient to have $\tau$ on the form
\[ \tau = -(T^T K_p \tilde \omega + K_d \omega + (I_g \omega) \times \omega) \]
Where $K_p$ and $K_d$ are positive definite diagonal matrices.



\section{Task 2.2}

\section{Task 3.1}
Now i wish to implement attitude control based on quaternions. I wish to use the setpoint given in euler angles:
\[\Theta_d = \begin{bmatrix} 10\degree && 20\degree && -10\degree \end{bmatrix} \]
I will use matlab and mss toolbox to calculate the setpoint in quaternions
\begin{lstlisting}[frame=single]
>> degree = @(rad) rad*180/pi;
>> euler2q(degree(10), degree(20), degree(-10))

ans =

   -0.0340
    0.6035
    0.5201
   -0.6035
\end{lstlisting}

\end{document}
